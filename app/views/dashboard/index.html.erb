
<%= form_with(
  url: dashboard_stamp_path,
  id: "main-form",
  class: "basic-wrap mt-4 mb-4",
  data: {
    controller: "forms",
    action: "forms#submit ajax:error->forms#ajaxError ajax:success->forms#ajaxSuccess",
  }) do |f| %>
  <div class="basic-header">
    <h3 class="title">打刻</h3>
  </div>
  <hr>
  <div class="text-center">
    <div class="btn-group w-100">
      <% if @stamp&.active? %>
        <button type="submit" class="btn btn-secondary btn-lg disabled" data-target="forms.submitButton">開始</button>
        <button type="submit" class="btn btn-primary btn-lg ml-4" data-target="forms.submitButton">終了</button>
      <% else %>
        <button type="submit" class="btn btn-primary btn-lg" data-target="forms.submitButton">開始</button>
        <button type="submit" class="btn btn-secondary btn-lg disabled ml-4" data-target="forms.submitButton">終了</button>
      <% end %>
    </div>
  </div>
<% end %>

<div class="page-filters" data-controller="page-filters">
  <div class="rendition-types">
    <div class="dropdown">
      <a data-toggle="dropdown" data-target="#" data-controller="links" data-action="links#click" href="javascript:void(0);">
        <i class="icon-users"></i>Team Member Grid
      </a>
      <div class="dropdown-menu">
        <div class="dropdown-menu-inner">
          <a data-controller="links" data-action="links#click" href="#"><i class="icon-users"></i>Team Member Grid</a>
          <a data-controller="links" data-action="links#click" href="#"><i class="icon-flag"></i>Position Grid</a>
          <a data-controller="links" data-action="links#click" href="#"><i class="icon-map-marker-alt"></i>Location Grid</a>
          <a data-controller="links" data-action="links#click" href="#"><i class="icon-calendar-alt"></i>Calendar</a>
          <a data-controller="links" data-action="links#click" href="#"><i class="icon-list"></i>List</a>
        </div>
      </div>
    </div>
  </div>

  <div class="filter-collections">
    <a data-controller="links" data-action="links#click" data-links-remote-modal="pane" data-remote="true" href="#"><i class="icon-filter"></i>Add Filter</a>
  </div>
</div>

<div class="page-body">
  <div class="grid-wrapper">
    <div class="grid-header">
      <div class="cell"></div>
      <% (0..23).each do |i| %>
        <div class="cell"><%= (i + 4) % 24 %></div>
      <% end %>
    </div>
    <div class="day grid-wrapper">
      <div class="grid">

        <% @stamps.each do |date, stamp| %>
          <div class="grid-row">
            <div class="cell">
              <div class="title"><%= date.to_s(:jp_ymd) %></div>
              <% unless stamp.nil? %>
                <div class="totals">
                  <div class="total"><%= time_hm(stamp.total_in_sec) %></div>
                  <div class="total">(休憩 <%= time_hm(stamp.total_out_sec) %>)</div>
                </div>
              <% end %>
            </div>
            <div class="w-100">
              <% (stamp&.timeframe_rows || []).each do |timeframe| %>
                <a data-controller="stamp-cell" data-action="stamp-cell#showModal" data-stamp-cell-json="<%= timeframe.to_json %>" class="editable schedule-cell normal" data-target="stamp-cell.cell" style="display:grid;<%= timeframe_style(timeframe) %>">
                  <i class="color-border" style="background:#8a8a48"></i>
                  <div class="heading">
                    <div class="title"><%= "#{timeframe.in_at.to_s(:hm)} - #{timeframe.out_at.nil? ? "継続" : timeframe.out_at.to_s(:hm)}" %></div>
                  </div>
                  <div class="details"></div>
                </a>
              <% end %>
            </div>
          </div>
        <% end %>

        <div class="grid-row hour-lines">
          <% (0..24).each do |i| %>
            <div class="cell"></div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>


<template id="stamp-show-modal-template">
  <%= form_with(
  url: stamp_update_path,
  id: "modal-form",
  data: {
    controller: "forms",
    action: "forms#submit ajax:error->forms#ajaxError ajax:success->forms#ajaxSuccess",
  }) do |f| %>
    <div class="modal-header" data-target="forms.refreshWrapper"打刻 修正
      <div class="button-group-field" data-controller="button-group-field">
        <a class="btn fields" data-target="button-group-field.button" data-action="button-group-field#clickButton" data-value="fields">修正</a>
        <a class="btn duplicate active" data-target="button-group-field.button" data-action="button-group-field#clickButton" data-value="duplicate">コピー</a>
      </div>
    </div>

    <div class="modal-body">
      <div data-form-state="fields" data-target="form-states.formStateWrapper" class="">
        <div class="form-row">
          <div class="form-group"><label for="bulk_shift_form_location_id">組織</label>
            <div class="select-list-wrapper" data-controller="select-list-field" data-divider-name="Locations" data-divider-values="[]" data-selected-values="[&quot;&quot;]">
              <div class="dropdown">
                <a class="btn btn-input" data-flip="false" data-toggle="dropdown" data-target="select-list-field.button" data-action="select-list-field#focusSearch">
                  <div class="select-list-item-label">aaa</div>
                </a>
              </div>
            </div>
          </div>
          <div class="form-group"><label for="bulk_shift_form_location_id">名前</label>
            <div class="select-list-wrapper" data-controller="select-list-field" data-divider-name="Locations" data-divider-values="[]" data-selected-values="[&quot;&quot;]">
              <div class="dropdown">
                <a class="btn btn-input" data-flip="false" data-toggle="dropdown" data-target="select-list-field.button" data-action="select-list-field#focusSearch">
                  <div class="select-list-item-label">松村 遼</div>
                </a>
              </div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="bulk_shift_form_date">日付</label>
            <div class="btn-group" data-controller="date-range-picker" data-target="date-range-picker.picker">
              <input data-target="date-field.input" class="form-control" type="text" value="2020/9/19" id="bulk_shift_form_date">
            </div>
          </div>

          <div class="shift-date-field-wrapper">

            <div class="form-group">
              <label for="bulk_shift_form_start_time">Start Time</label>
              <input data-target="bulk-shifts--form.startTimeField" data-action="timeChanged->forms#triggerRefresh" data-controller="time-field" placeholder="e.g. 10am" class="form-control ui-timepicker-input" type="text" value="8:00am" name="bulk_shift_form[start_time]" id="bulk_shift_form_start_time" autocomplete="off">
            </div>

            <div class="form-group" data-target="forms.refreshWrapper">
              <div class="select-list-wrapper" data-controller="select-list-field">
                <div class="dropdown">
                  <a class="btn btn-input hide-caret" data-flip="false" data-toggle="dropdown" data-target="select-list-field.button" data-action="select-list-field#focusSearch" aria-expanded="false">
                    <span class="placeholder"></span>
                  </a>
                  <div class="dropdown-menu" x-placement="bottom-start" style="position: absolute; transform: translate3d(0px, 40px, 0px); top: 0px; left: 0px; will-change: transform;">
                    <div class="select-list">
                      <div class="select-list-items" data-target="select-list-field.list">
                        <label class="select-list-item" data-target="select-list-field.item" data-action="click->shifts--form#selectShiftTemplate" data-break-time="0" data-start-time="10:00am" data-end-time="5:00pm">
                          <input data-action="select-list-field#updateButton forms#triggerRefresh" data-target="select-list-field.itemInput" type="radio" value="91221" name="bulk_shift_form[shift_template_id]" id="bulk_shift_form_shift_template_id_91221">
                          <div class="select-list-item-label">10am - 5pm</div>
                        </label>
                        <label class="select-list-item" data-target="select-list-field.item" data-action="click->shifts--form#selectShiftTemplate" data-break-time="0" data-start-time="1:30pm" data-end-time="10:00pm">
                          <input data-action="select-list-field#updateButton forms#triggerRefresh" data-target="select-list-field.itemInput" type="radio" value="91222" name="bulk_shift_form[shift_template_id]" id="bulk_shift_form_shift_template_id_91222">
                          <div class="select-list-item-label">1:30pm - 10pm</div>
                        </label>
                        <div class="select-list-divider">Not assigned to position/location:</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="bulk_shift_form_end_time">End Time</label>
            <input data-target="bulk-shifts--form.endTimeField" data-action="timeChanged->forms#triggerRefresh" data-controller="time-field" placeholder="e.g. 5pm" class="form-control ui-timepicker-input" type="text" value="1:30pm" name="bulk_shift_form[end_time]" id="bulk_shift_form_end_time" autocomplete="off">
          </div>

          <div class="form-group" style="max-width:120px">
            <label for="bulk_shift_form_break_time_minutes">Unpaid Break</label>
            <div class="input-group">
              <input duration="min" data-target="bulk-shifts--form.breakTimeField" data-action="forms#triggerRefresh" step="any" placeholder="e.g. 15" class="form-control" type="number" name="bulk_shift_form[break_time_minutes]" id="bulk_shift_form_break_time_minutes">
              <div class="input-group-append">
                <div class="input-group-text">min</div>
              </div>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="bulk_shift_form_note">Note</label>
          <textarea data-target="bulk-shifts--form.noteField" placeholder="e.g. Any other information you want to include..." class="form-control" name="bulk_shift_form[note]" id="bulk_shift_form_note"></textarea>
        </div>

        <div class="" data-target="bulk-shifts--form.notAssignedFields">
          <div class="modal-divider">Open Shift Options</div>
          <div class="form-group">
            <label for="bulk_shift_form_public">Public Offer</label>
            <div class="toggle-well">
              <div class="form-text">Offer this shift to everyone who is eligible to pick it up. If not, you can pick specific team members to offer it to.</div>
              <div class="toggle-field" data-controller="toggle-field">
                <input data-action="bulk-shifts--form#togglePublic" data-target="bulk-shifts--form.publicInput toggle-field.hiddenInput" type="hidden" value="true" name="bulk_shift_form[public]" id="bulk_shift_form_public">
                <a class="toggle-switch on animate" data-target="toggle-field.switch" data-action="toggle-field#clickSwitch"></a>
              </div>
            </div>
          </div>
        </div>

        <script>
          $('.tooltip').tooltip('hide');
          $('#bulk_shift_form_assignment_ids').next().next().css("max-width", "540px");
          $('#bulk_shift_form_assignment_ids').next().hide();
          
          if ($('#bulk_shift_form_wage_flag').val() == "false") {
            $('#bulk_shift_form_wage_dollars').css("background-color", "#F8FAFC");
            $('#bulk_shift_form_wage_dollars').val('');
          }
          
          $('#bulk_shift_form_wage_dollars').on('click',function(){
            $('#bulk_shift_form_wage_dollars').removeAttr("style");
            $('#bulk_shift_form_wage_flag').val('clicked');
          });
          
          $('[data-toggle="tooltip"]').tooltip();
        </script>
      </div>
    </div>

    <div class="modal-footer">
      <div class="label" id="selectedMemberCount">You selected 0 Members Total</div>

      <button name="bulk_shift_form[published]" type="submit" value="true" class="btn btn-default" data-target="forms.submitButton">Save &amp; Publish</button>
      <button type="submit" class="btn btn-blue" data-target="forms.submitButton">Save</button>
    </div>
  <% end %>
</template>


